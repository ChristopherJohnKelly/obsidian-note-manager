name: Obsidian Ingestion Pipeline

on:
  push:
    paths:
      - '00. Inbox/0. Capture/**/*.md'  # Trigger on new captures
      - '00. Inbox/1. Review Queue/**/*.md'  # Trigger on review queue changes (librarian: file)
    branches:
      - master  # Branch is 'master'

permissions:
  contents: write

jobs:
  librarian:
    runs-on: self-hosted  # Targets your Pi
    steps:
      - name: Checkout Vault
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}  # Needed for push permission

      - name: Run Librarian
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}  # Passed from GitHub Secrets
          OBSIDIAN_VAULT_ROOT: ${{ github.workspace }}  # Set vault root to workspace
        run: |
          echo "ðŸ“‚ Starting Ingestion..."
          python3 /home/runner/src/main.py
